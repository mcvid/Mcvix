<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div id="auth-screen" class="auth-screen">
        <!-- LOGIN FORM -->
        <div class="auth-form" id="login-form">
          <h2>Welcome Back</h2>
          <input type="email" id="email" placeholder="Email" required oninput="validateLogin()" />
          <input type="password" id="password" placeholder="Password (min 8 chars)" required oninput="validateLogin()" />
          <button id="login-btn" onclick="login()" disabled>Login</button>
          <p>
            Don’t have an account?
            <span onclick="showSignup()" class="switch-link"><a href="">Sign up</a></span>
          </p>
          <div id="g-signin2"></div>
        </div>
      
        <!-- SIGNUP FORM -->
        <div class="auth-form" id="signup-form" style="display:none;">
          <h2>Create Account</h2>
          <input type="email" id="signupEmail" placeholder="Email" required oninput="validateSignup()" />
          <input type="password" id="signupPassword" placeholder="Password (min 8 chars)" required oninput="validateSignup()" />
          <button id="signup-btn" onclick="signup()" disabled>Sign Up</button>
          <p>
            Already have an account?
            <span onclick="showLogin()" class="switch-link">Log in</span>
          </p>
        </div>
      </div>
      <script>
        function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const users = JSON.parse(localStorage.getItem("users")) || {};
    
      if (!users[email]) {
        alert("Account not found. Please sign up first.");
        return;
      }
    
      if (password.length < 8) {
        alert("Password must be at least 8 characters.");
        return;
      }
    
      if (users[email].password !== password) {
        alert("Incorrect password.");
        return;
      }
    
      // Store session temporarily
      sessionStorage.setItem("loggedInUser", email);
    
      // Redirect or show home page
      window.location.href = "home.html"; // or your homepage logic
    }
    const loggedIn = sessionStorage.getItem("loggedInUser");
    
    if (!loggedIn) {
      alert("You must log in first.");
      window.location.href = "index.html"; // back to login
    }
    sessionStorage.removeItem('loggedInUser');
    
        function validateEmail(e) {
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
        }
      
        // --- Toggle Forms ---
        function showSignup() {
          loginForm.style.display = 'none';
          signupForm.style.display = 'block';
        }
        function showLogin() {
          signupForm.style.display = 'none';
          loginForm.style.display = 'block';
        }
      
        // --- Real‑time Validation ---
        function validateLogin() {
          const ok = validateEmail(email.value) && password.value.length >= 8;
          loginBtn.disabled = !ok;
        }
        function validateSignup() {
          const ok = validateEmail(signupEmail.value) && signupPassword.value.length >= 8;
          signupBtn.disabled = !ok;
        }
      
        // --- Core Logic ---
        function login() {
          const e = email.value, p = password.value;
          const stored = JSON.parse(localStorage.getItem(e) || 'null');
      
          if (!stored) {
            return alert("Account doesn't exist.");
          }
          if (stored.password !== p) {
            return alert("Wrong password.");
          }
          localStorage.setItem("loggedInUser", e);
          window.location.href = 'home.html';
        }
      
        function signup() {
          const e = signupEmail.value, p = signupPassword.value;
          if (localStorage.getItem(e)) {
            return alert("Account already exists. Please log in.");
          }
          localStorage.setItem(e, JSON.stringify({ password: p }));
          localStorage.setItem("loggedInUser", e);
          window.location.href = 'home.html';
        }
      
        function handleCredentialResponse(response) {
        
          const payload = JSON.parse(atob(response.credential.split('.')[1]));
          const email = payload.email;
          if (!localStorage.getItem(email)) {
            alert("No account found for " + email);
            return;
          }
          localStorage.setItem("loggedInUser", email);
          window.location.href = 'home.html';
        }
      
       
        window.addEventListener('DOMContentLoaded', () => {
          
          window.email = document.getElementById('email');
          window.password = document.getElementById('password');
          window.signupEmail = document.getElementById('signupEmail');
          window.signupPassword = document.getElementById('signupPassword');
          window.loginBtn = document.getElementById('login-btn');
          window.signupBtn = document.getElementById('signup-btn');
          window.loginForm = document.getElementById('login-form');
          window.signupForm = document.getElementById('signup-form');
      
    
          if (!localStorage.getItem('loggedInUser')) {
            document.getElementById('auth-screen').style.display = 'flex';
          } else {
            document.getElementById('auth-screen').style.display = 'none';
          
          }
      
      
          google.accounts.id.initialize({
            client_id: '642285597123-069m3g4j8t49if8u2dp626fi3e02h25u.apps.googleusercontent.com',
            callback: handleCredentialResponse
          });
          google.accounts.id.renderButton(
            document.getElementById('g-signin2'),
            { theme: 'outline', size: 'large' }
          );
        });
    </script>
</body>
</html>